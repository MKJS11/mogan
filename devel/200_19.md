# 200_19 windows安装程序改进

## 2025/07/30 

### What

改进了Windows安装程序，添加了自动卸载老版本的功能。

#### 主要改进：

**自动检测老版本**：
- 在安装前检查注册表中是否存在老版本的安装路径
- 支持管理员权限（HKLM）和普通用户权限（HKCU）两种模式
- 使用`TrimQuote`函数清理路径中的引号

**智能安装路径选择**：
- 如果检测到老版本，自动安装到老版本位置
- 如果没有老版本，安装到默认位置

**自动卸载老版本**：
- 在安装新版本前自动调用老版本的卸载程序
- 使用静默卸载模式（`/S`参数）
- 如果卸载失败，显示错误信息并中止安装

### Why

**用户体验改进**：
- 用户无需手动卸载老版本，安装程序自动处理
- 避免版本冲突和文件残留问题
- 简化安装流程

**错误修复**：
- 修复NSIS脚本中的非标准函数调用
- 确保安装程序能够正常编译和运行
- 提高代码的兼容性和稳定性

**安装可靠性**：
- 自动检测和处理老版本，减少安装失败的情况
- 提供清晰的错误信息，帮助用户解决问题
- 支持不同权限级别的安装场景