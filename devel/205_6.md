# 205_6 MuPDF：修复裁剪区域设置异常
## 如何测试
启用MuPDF后编译、运行，菜单栏点击插入->图片->绘制图形，可以正常绘制各种图形

## 2025/07/21
### What
问题根源在于，在绘制图形过程中，两个不同的`mupdf_renderer_rep`对象频繁、交替调用`set_clipping`函数，造成MuPDF内部图形状态管理异常，进而造成页面显示异常和崩溃。
1. 重写`mupdf_renderer_rep::set_clipping()`函数，重点解决不同`mupdf_renderer_rep`对象交替调用时，MuPDF图形状态能够统一。
2. 引入类静态变量`clip_active`，`clip_proc`统一管理裁剪设置的状态。
    - `clip_active`指示裁剪区域是否已被设置，在`mupdf_renderer_rep::end`中，裁剪设置会还原。
    - `clip_proc`保存上一次调用`set_clipping`函数的`mupdf_renderer_rep`对象中的MuPDF图形状态（`pdf_processor* proc`）地址，确保交替调用时，能够将上一次保存的图形状态顺利还原。

### Why
在启用MuPDF渲染器后，无法正常绘制图形，在绘制图形界面容易崩溃。
