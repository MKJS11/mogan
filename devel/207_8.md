# 207_8 lolly哈希的性能优化

## 测试方法
```shell
rm xmake.lua
cd 3rdparty/lolly
xmake run hashmap_bench
```

## 2025/07/24 提升哈希表相关操作的性能

### What

1. 优化了 `hashmap` 模块中多个关键函数的实现，包括插入（`operator()`）、查找（`contains()`）、合并（`join()`）以及生成测试（`generate()`）。对部分函数采用迭代替代递归实现，减少拷贝、提升缓存友好性。
2. 添加了哈希表的benchmark

### Why

原有实现中存在不必要的拷贝与递归逻辑，通过精简路径与更合适的算法选择，多个 benchmark 指标得到了优化。

### How

* 对 `copy_list()` 提供迭代版，避免递归带来的栈开销与指针复制。
* 对 `insert [operator()]` 优化数据分布路径与探测逻辑。
* 引入轻量 `resize` 操作基准以精确评估扩容开销。

### Benchmark 对比（单位：ns/op）

| Benchmark               | 优化前          | 优化后          | 提升幅度        |
| ----------------------- | ------------ | ------------ | ----------- |
| `insert [operator()]`   | 5,543,558.00 | 4,785,649.00 | **13.7%** 快 |
| `contains() hits`       | 476,819.00   | 468,739.50   | 微弱提升        |
| `join() two maps`       | 6,541,171.00 | 6,596,618.00 | 基本不变     |
| `generate()`            | 0.75         | 0.75         | 基本不变         |
| `copy_list (recursive)` | 207,308.50   | -            | -           |
| `copy_list (iterative)` | -            | 127,925.22   | **38.3%** 快 |
| `single resize op`      | 213.25       | 201.82       | **5.4%** 快  |
