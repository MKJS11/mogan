# 203_8 修复打印DPI设置问题

## 如何测试

测试文件：TeXmacs/tests/tmu/203_8_test.tmu

测试1-在100%缩放比下分别在main分支和当前分支导出pdf，对比两个pdf文件和tmu文件：

区别：当前分支下导出的pdf和软件内屏幕显示的一致，main分支下导出结果是不一致的（因为测试文件使用了`px`等参数）

测试2-在200%缩放比下分别在main分支和当前分支导出pdf，对比四个pdf文件和tmu文件：

区别：如果文件内有框架使用`px`等作为单位，那么在不同缩放比下呈现的效果是不一样的。main分支导出结果在不同缩放比下一致；当前分支导出结果和不同缩放比下屏幕呈现效果一致。


## 2025/09/04

## What

修复了打印功能中DPI设置的问题：
- 移除了`env->write(DPI, printing_dpi)`这行代码
- 将`int dpi = as_int(printing_dpi)`改为`int dpi = env->get_int(DPI)`

## Why

在打印文档时，代码中存在两套DPI设置机制：
1. 全局变量`printing_dpi`（固定为"600"）
2. 环境变量`DPI`（直接读取屏幕dpi）

之前是使用固定的`printing_dpi`,如果在软件中设定参数如`px`之类的，不仅软件内修改缩放比页面会发生变化，导出后也没有做到“所见即所得”。
修改后导出的效果和在软件内当前缩放下的效果一致（如果缩放修改，页面发生变化，pdf导出也会跟着变）。
