# 201_11 数学补全\快捷键循环补全
## 如何测试
### 测试转化box_widget内容为qwidget
我们使用辅助窗口来方便观察测试效果
1. 插入一个scheme块
2. 展示辅助窗口
```
(show-auxiliary-widget #t)
```
3. 运行
```
(set-auxiliary-widget (make-menu-widget '((tile 1 (link upper-greek-menu))) 0) "test")
```
或者更加基础的
```
(set-auxiliary-widget (make-menu-widget '(symbol "<alpha>") 0) "test")
```
4. 检查：右侧辅助窗口中正常出现数学符号的按钮

### 测试数学环境 Tab Cycling 补全项获取
注：这部分也有自动测试，在`201_11.scm`
1. 插入一个 Scheme 块
2. run
```
((lambda () (make 'math) (insert "in math") (math-variant "b") (show-auxiliary-widget #t))))))
```
3. 检查结果

## 2025/07/31 数学环境 Tab Cycling 补全项获取
### What
- 在`math-edit.scm`中添加了函数`math-tabcycle-symbols`用于在数学环境下获取 TabCycling 补全项
- 在`math-edit.scm`中添加了函数`math-variant`用于展示 TabCycling 补全项

目前TabCycling补全项由辅助窗口展示。将来会改成新的UI组件。

## 2025/07/29 支持转化box_widget内容为qwidget
### What
修改了as_qwidget中case menu_button情况下的逻辑，在没有精确匹配到type=xpm_widget或者text_widget的时候默认包装此widget的as_qaction为一个QToolButton作为返回的qwidget。

### Why
此修改是为了将box_widget作为qwidget显示。显示数学内容需要box_widget，而目前box_widget的只有as_qaction逻辑是正确的，as_qwidget逻辑是不正确的，得到的结果是一个空的QPushButton。

## 2025/07/29 给make-menu-symbol添加颜色参数
### What
- 给make-menu-symbol添加颜色参数
- 添加了新的case，`symbol*`创建红色的make-menu-symbol（以后的选中效果）

### 如何测试？
目前没有好的测试方法，就不写在上面了。这是因为作为widget显示menu-symbol的代码还没有合并。
可以手动修改
```
  (symbol (:string? :*)
          ,(lambda (p style bar?) (list (make-menu-symbol p style (color "black")))))
```
中的颜色，例如从`black`改成`red`。
然后进入数学模式，点击工具栏的数学符号随便打开一个菜单，观察数学符号的颜色

## 2025/07/28 快捷键前缀查找kbd-find-prefix的实现和测试
### What
实现了当前可用快捷键的前缀查找kbd-find-prefix，并添加了测试。

### Why
为将来在数学模式中补全提供底层接口。（数学模式的Tab Cycling是由快捷键定义的）

### 如何测试？
直接`xmake r 201_4`。这部分提供了自动测试，就不写到上面的测试章节中了。

